--[[
based on reyfield   :-)
Zelnka22           (^_^)
]]

local StarterGui = game:GetService("StarterGui")
StarterGui:SetCore("ChatMakeSystemMessage", {
    Text = "ring by Zelnka22";
    Color = Color3.fromRGB(200, 200, 200);
    Font = Enum.Font.Fondamento;
    FontSize = Enum.FontSize.Size24;
})

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer
local HttpService = game:GetService("HttpService")

local configFile = "RingPartsConfig.txt"
local config = {
    radius = 50,
    height = 100,
    rotationSpeed = 10,
    attractionStrength = 1000,
}

local function saveConfig()
    if writefile then
        writefile(configFile, HttpService:JSONEncode(config))
    end
end

local function loadConfig()
    if isfile and isfile(configFile) then
        config = HttpService:JSONDecode(readfile(configFile))
    end
end
loadConfig()

local Window = Rayfield:CreateWindow({
    Name = "Ring Parts by Zelnka22",
    LoadingTitle = "ща загрузится",
    LoadingSubtitle = "я круасан",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = nil,
        FileName = "RingPartsConfig",
    },
    Discord = {
        Enabled = false,
    }
})

local RingTab = Window:CreateTab("кольцо/ring")
local AdditionalTab = Window:CreateTab("доп штуки/Additional stuff")
local GitHubTab = Window:CreateTab("гитхаб/github")

local ringPartsEnabled = false
local parts = {}

local function isValidPart(part)
    if not part:IsA("BasePart") then return false end
    if part.Anchored then return false end
    if not part.Parent then return false end
    if part:IsDescendantOf(LocalPlayer.Character) then return false end
    if part.Name == "Terrain" then return false end
    if part:IsDescendantOf(Workspace.Terrain) then return false end
    if part.Size.Magnitude > 50 then return false end
    if part.Position.Y < 5 then return false end
    return true
end

local function tryAddPart(part)
    if isValidPart(part) and not table.find(parts, part) then
        table.insert(parts, part)
        part.CanCollide = false
        part.CustomPhysicalProperties = PhysicalProperties.new(0, 0, 0, 0, 0)
    end
end

for _, part in pairs(Workspace:GetDescendants()) do
    tryAddPart(part)
end

Workspace.DescendantAdded:Connect(function(part)
    tryAddPart(part)
end)

local Attachment1 = Instance.new("Attachment")
Attachment1.Parent = workspace.Terrain -- чтобы не было на персонаже

RunService.Heartbeat:Connect(function()
    if not ringPartsEnabled then return end
    local char = LocalPlayer.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    local center = hrp.Position

    Attachment1.WorldPosition = center

    for i = #parts, 1, -1 do
        local part = parts[i]
        if not part or not part.Parent or not isValidPart(part) then
            table.remove(parts, i)
        else
            local pos = part.Position
            local horizontalOffset = Vector3.new(pos.X - center.X, 0, pos.Z - center.Z)
            local dist = horizontalOffset.Magnitude
            local angle = math.atan2(pos.Z - center.Z, pos.X - center.X)
            local newAngle = angle + math.rad(config.rotationSpeed)

            local targetRadius = math.min(config.radius, dist)
            local targetX = center.X + math.cos(newAngle) * targetRadius
            local targetZ = center.Z + math.sin(newAngle) * targetRadius

            local verticalOffset = pos.Y - center.Y
            local targetY = center.Y + math.clamp(verticalOffset, -config.height, config.height)

            local targetPos = Vector3.new(targetX, targetY, targetZ)
            local direction = (targetPos - pos)

            if direction.Magnitude > 0 then
                local velocity = direction.Unit * config.attractionStrength
                velocity = Vector3.new(velocity.X, math.clamp(velocity.Y, -50, 50), velocity.Z)
                part.Velocity = velocity
            end
        end
    end
end)

RingTab:CreateToggle({
    Name = "Включить кольцо",
    CurrentValue = ringPartsEnabled,
    Flag = "RingEnabled",
    Callback = function(value)
        ringPartsEnabled = value
    end
})

RingTab:CreateSlider({
    Name = "Radius",
    Range = {0, 300},
    Increment = 5,
    Suffix = " studs",
    CurrentValue = config.radius,
    Flag = "RingRadius",
    Callback = function(value)
        config.radius = value
        saveConfig()
    end
})

RingTab:CreateSlider({
    Name = "Height",
    Range = {0, 300},
    Increment = 5,
    Suffix = " studs",
    CurrentValue = config.height,
    Flag = "RingHeight",
    Callback = function(value)
        config.height = value
        saveConfig()
    end
})

RingTab:CreateSlider({
    Name = "Rotation Speed",
    Range = {0, 100},
    Increment = 1,
    Suffix = " degrees/frame",
    CurrentValue = config.rotationSpeed,
    Flag = "RingRotationSpeed",
    Callback = function(value)
        config.rotationSpeed = value
        saveConfig()
    end
})

RingTab:CreateSlider({
    Name = "Attraction Strength",
    Range = {0, 3000},
    Increment = 50,
    Suffix = " velocity",
    CurrentValue = config.attractionStrength,
    Flag = "RingAttraction",
    Callback = function(value)
        config.attractionStrength = value
        saveConfig()
    end
})

AdditionalTab:CreateButton({
    Name = "No Fall",
    Callback = function()
        local RunService = game:GetService("RunService")
        local heartbeat = RunService.Heartbeat
        local rstepped = RunService.RenderStepped
        local lp = game.Players.LocalPlayer
        local zeroVelocity = Vector3.new(0, 0, 0)

        local function nofalldamage(chr)
            local root = chr:WaitForChild("HumanoidRootPart")
            if root then
                local con
                con = heartbeat:Connect(function()
                    if not root.Parent then con:Disconnect() end
                    local oldvel = root.AssemblyLinearVelocity
                    root.AssemblyLinearVelocity = zeroVelocity
                    rstepped:Wait()
                    root.AssemblyLinearVelocity = oldvel
                end)
            end
        end

        nofalldamage(lp.Character)
        lp.CharacterAdded:Connect(nofalldamage)
    end
})

AdditionalTab:CreateButton({
    Name = "Noclip",
    Callback = function()
        local RunService = game:GetService("RunService")
        local Clip = false
        local NoclipConnection

        local function noclip()
            Clip = false
            local function Nocl()
                if not Clip and game.Players.LocalPlayer.Character then
                    for _, v in pairs(game.Players.LocalPlayer.Character:GetDescendants()) do
                        if v:IsA("BasePart") and v.CanCollide then
                            v.CanCollide = false
                        end
                    end
                end
                wait(0.21)
            end
            NoclipConnection = RunService.Stepped:Connect(Nocl)
        end

        local function clip()
            if NoclipConnection then NoclipConnection:Disconnect() end
            Clip = true
        end

        noclip()
    end
})

AdditionalTab:CreateButton({
    Name = "Inf Yield",
    Callback = function()
        loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source'))()
    end
})

GitHubTab:CreateButton({
    Name = "мой гитхаб/my github",
    Callback = function()
        if setclipboard then
            setclipboard("https://github.com/Zelnka22")
        else
            warn("setclipboard не поддерживается в этой среде")
        end
    end
})
